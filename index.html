<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Digital DJ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #020617;
      color: #e5e7eb;
      padding: 40px;
      max-width: 700px;
      margin: auto;
    }
    h1 { color: #22d3ee; }
    select, button, input {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      border-radius: 6px;
      border: none;
    }
    button {
      background: #22d3ee;
      color: #020617;
      font-weight: bold;
      cursor: pointer;
    }
    .card {
      background: #0f172a;
      padding: 20px;
      margin-top: 20px;
      border-radius: 12px;
    }
    li { margin-bottom: 6px; }
    small { color: #94a3b8; }
  </style>
</head>

<body>
  <h1>üéß Digital DJ</h1>
  <p>Select your mood and get a curated playlist.</p>

  <select id="mood">
    <option value="Happy">Happy</option>
    <option value="Focused">Focused</option>
    <option value="Chill">Chill</option>
    <option value="Stressed">Stressed</option>
  </select>

  <button onclick="generatePlaylist()">Generate Playlist</button>

  <div id="playlist"></div>

  <div id="rating" style="display:none;">
    <input type="number" id="ratingValue" min="1" max="5" placeholder="Rate (1‚Äì5)">
    <button onclick="submitRating()">Submit Rating</button>
  </div>

  <div id="analytics"></div>

  <script>
    const API_BASE = "https://arshad.pythonanywhere.com";
    let currentMood = null;

    async function generatePlaylist() {
      const mood = document.getElementById("mood").value;
      currentMood = mood;

      const res = await fetch(`${API_BASE}/playlist`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mood })
      });

      const data = await res.json();

      if (data.error) {
        alert(data.error);
        return;
      }

      let html = `<div class="card"><h2>${data.mood} Playlist</h2><ol>`;
      data.playlist.forEach(song => {
        html += `<li>${song.Song} ‚Äì ${song.Artist} <small>(${song.Duration} min)</small></li>`;
      });
      html += `</ol></div>`;

      if (data.recommendation) {
        html += `<p>üîÅ Users who liked <b>${data.mood}</b> also liked <b>${data.recommendation}</b></p>`;
      }

      document.getElementById("playlist").innerHTML = html;
      document.getElementById("rating").style.display = "block";

      loadAnalytics();
    }

    async function submitRating() {
      const rating = document.getElementById("ratingValue").value;

      if (!rating || rating < 1 || rating > 5) {
        alert("Please enter a rating between 1 and 5.");
        return;
      }

      await fetch(`${API_BASE}/rate`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          mood: currentMood,
          rating: parseInt(rating)
        })
      });

      alert("Rating saved!");
      document.getElementById("ratingValue").value = "";
      loadAnalytics();
    }

    async function loadAnalytics() {
      const res = await fetch(`${API_BASE}/analytics`);
      const data = await res.json();

      let html = `<div class="card"><h3>üìä Analytics</h3>`;
      html += `<p><b>Top Moods:</b> ${data.top_moods.map(m => m[0]).join(", ")}</p>`;
      html += `<p><b>Average Ratings:</b></p><ul>`;

      for (const mood in data.average_ratings) {
        html += `<li>${mood}: ${data.average_ratings[mood]} ‚≠ê</li>`;
      }

      html += `</ul></div>`;
      document.getElementById("analytics").innerHTML = html;
    }
  </script>
</body>
</html>
